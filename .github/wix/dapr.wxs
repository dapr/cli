<?xml version='1.0' encoding='windows-1252'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>

  <!-- Product IDs are autogenerated (*) at every build-->
  <Product Name='Dapr CLI' Id='*' UpgradeCode='ed31d74d-b958-4db2-910f-de85c0a9cea0' Language='1033' Codepage='1252' Version='$(var.Version)' Manufacturer='Dapr'>

    <!-- Installer Package-->
    <Package Id='*' Keywords='Installer' Description="Dapr CLI Installer" InstallerVersion='400' Languages='1033' Compressed='yes' SummaryCodepage='1252' />

    <!-- License Agreement -->
    <WixVariable Id="WixUILicenseRtf" Value="$(var.DaprLicenseDirectory)/license.rtf" />

    <!-- Upgrade logic -->
    <!-- AllowSameVersionUpgrades "yes" -> Always upgrade, never allow two versions to be installed next to each other -->
    <!-- AllowSameVersionUpgrades causes ICE61 which must be ignored -->
    <!-- AllowDowngrades "no" -> Prevents out-of-order installations i.e. installing an older version after installing a newer version -->
    <MajorUpgrade AllowSameVersionUpgrades="yes" AllowDowngrades="no" DowngradeErrorMessage="A later version of Dapr CLI is already installed. Setup will now exit."/>

    <Media Id='1' Cabinet='Dapr.cab' EmbedCab='yes' />

    <!-- Directory Structure -->
    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id='INSTALLDIR' Name = 'dapr'>
      <!-- Default Installation Directory set to $env:SystemDrive\dapr -->

        <!-- Dapr EXE Component -->
        <Component Id='DaprEXE_Comp' Guid='83363a24-2323-489c-b9b7-a3fd7f0dacd1'>
          <File Id='DaprEXE' Name='dapr.exe' DiskId='1' Source='$(var.DaprEXEDirectory)/dapr.exe' KeyPath='yes'>
          </File>
        </Component>

        <!-- Update PATH Environment Variable -->
        <Component Id='UpdatePATH_Comp' Guid='0198647e-bae8-47e6-b9ff-01881ee540ae'>
        <CreateFolder />
        <Environment Id='Dapr_Path' Name="PATH" Action="set" System="no" Part="last" Value="[INSTALLDIR]" />
        </Component>

      </Directory>
    </Directory>

    <!-- Set Root Installation Directory to System Drive(C:\) -->
  <CustomAction Id="SetTARGETDIR" Property="TARGETDIR" Value="[WindowsVolume]" Return="check" />

  <InstallUISequence>
    <Custom Action="SetTARGETDIR" Sequence = '1'  />
  </InstallUISequence>

  <InstallExecuteSequence>
    <Custom Action="SetTARGETDIR" Sequence = '1'  />
  </InstallExecuteSequence>

    <Feature Id='Complete' Level='1'>
      <ComponentRef Id='DaprEXE_Comp' />
      <ComponentRef Id='UpdatePATH_Comp' />
    </Feature>

    <!-- Dialog to let the user choose a directory where the product will be installed-->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
    <UIRef Id="WixUI_InstallDir" />

  </Product>
</Wix>
     